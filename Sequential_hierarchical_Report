DATA V_VBELN TYPE VBAK-VBELN.
SELECT-OPTIONS SO_VBELN FOR V_VBELN DEFAULT '4971' TO '4980' NO-EXTENSION.

TYPES: BEGIN OF TY_SALESHEADER,
      VBELN TYPE VBAK-VBELN,
      ERDAT TYPE VBAK-ERDAT,
      ERZET TYPE VBAK-ERZET,
      ERNAM TYPE VBAK-ERNAM,
  END OF TY_SALESHEADER.


  DATA : T_SALESHEADER TYPE TABLE OF TY_SALESHEADER,
        WA_SALESHEADER TYPE TY_SALESHEADER.


  TYPES: BEGIN OF TY_SALESITEMS,
      VBELN TYPE VBAP-VBELN,
      POSNR TYPE VBAP-POSNR,
      MATNR TYPE VBAP-MATNR,
      NETWR TYPE VBAP-NETWR,
  END OF TY_SALESITEMS.

  DATA: T_SALESITEMS TYPE TABLE OF TY_SALESITEMS,
        WA_SALESITEMS TYPE TY_SALESITEMS.

 START-OF-SELECTION.

  PERFORM GETASALESHEADERDATA.
  IF T_SALESHEADER IS NOT INITIAL.
    PERFORM GETSALESITEMSDATA.
  IF T_SALESITEMS IS NOT INITIAL.
    PERFORM DISPLAYSALESDATA.
    ENDIF.
    ENDIF.

  FORM GETASALESHEADERDATA.
    SELECT VBELN ERDAT ERZET ERNAM
      FROM VBAK
      INTO TABLE T_SALESHEADER
       WHERE VBELN IN SO_VBELN.
    ENDFORM.


FORM GETSALESITEMSDATA.
    LOOP AT T_SALESHEADER INTO WA_SALESHEADER.
    SELECT  VBELN POSNR MATNR NETWR
       APPENDING TABLE T_SALESITEMS
      FROM VBAP
      WHERE VBELN = WA_SALESHEADER-VBELN.
      ENDLOOP.
    ENDFORM.


    FORM DISPLAYSALESDATA.
      SORT  T_SALESHEADER BY VBELN.
      SORT T_SALESITEMS BY VBELN POSNR.
      LOOP AT T_SALESHEADER INTO WA_SALESHEADER.
        FORMAT COLOR 5.
        WRITE : / WA_SALESHEADER-VBELN,
                  WA_SALESHEADER-ERDAT,
                  WA_SALESHEADER-ERZET,
                  WA_SALESHEADER-ERNAM.
        LOOP AT T_SALESITEMS INTO WA_SALESITEMS WHERE VBELN = WA_SALESHEADER-VBELN.
        FORMAT COLOR 7.
        WRITE: /5 WA_SALESITEMS-VBELN,
                  WA_SALESITEMS-POSNR,
                  WA_SALESITEMS-MATNR,
                  WA_SALESITEMS-NETWR.
        ENDLOOP.
        ENDLOOP.
  ENDFORM.
